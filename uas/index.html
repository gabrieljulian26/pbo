<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Login & Registrasi - OOP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 450px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }

        input[type="text"],
        input[type="password"],
        input[type="email"],
        input[type="tel"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .switch-form {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 14px;
        }

        .switch-form a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .switch-form a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .hidden {
            display: none;
        }

        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .dashboard {
            text-align: center;
        }

        .dashboard h2 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .welcome-message {
            color: #666;
            margin-bottom: 25px;
            font-size: 15px;
        }

        .user-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
            border: 1px solid #dee2e6;
        }

        .user-info p {
            margin: 12px 0;
            color: #555;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info p strong {
            color: #333;
            min-width: 140px;
        }

        .user-info p span {
            color: #667eea;
            font-weight: 500;
            text-align: right;
            word-break: break-word;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-admin {
            background: #667eea;
            color: white;
        }

        .badge-member {
            background: #28a745;
            color: white;
        }

        .badge-active {
            background: #17a2b8;
            color: white;
        }

        .logout-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            margin-top: 20px;
        }

        .logout-btn:hover {
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .demo-accounts {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 13px;
            color: #666;
            border: 1px solid #dee2e6;
        }

        .demo-accounts strong {
            color: #333;
            display: block;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .demo-accounts p {
            margin: 8px 0;
            padding-left: 10px;
            border-left: 3px solid #667eea;
        }

        .demo-accounts code {
            background: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #667eea;
            font-weight: 600;
        }

        .form-footer {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: center;
            font-size: 12px;
            color: #999;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 480px) {
            .container {
                padding: 30px 20px;
            }

            h2 {
                font-size: 24px;
            }

            .user-info p {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .user-info p strong {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Form Login -->
        <div id="loginForm">
            <h2>üîê Login</h2>
            <div id="loginAlert"></div>
            <form id="loginFormElement">
                <div class="form-group">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" placeholder="Masukkan username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Masukkan password" required autocomplete="current-password">
                </div>
                <button type="submit" id="loginBtn">Login</button>
            </form>
            <div class="switch-form">
                Belum punya akun? <a id="linkToRegister">Daftar disini</a>
            </div>
            
            <div class="demo-accounts">
                <strong>üéØ Akun Demo:</strong>
                <p>1. Username: <code>admin</code> | Password: <code>admin123</code></p>
                <p>2. Username: <code>user1</code> | Password: <code>password1</code></p>
                <p>3. Username: <code>user2</code> | Password: <code>password2</code></p>
            </div>
            
            <div class="form-footer">
                ¬© 2024 Sistem Login - OOP Architecture. All rights reserved.
            </div>
        </div>

        <!-- Form Registrasi -->
        <div id="registerForm" class="hidden">
            <h2>üìù Daftar Akun Baru</h2>
            <div id="registerAlert"></div>
            <form id="registerFormElement">
                <div class="form-group">
                    <label for="regUsername">Username *</label>
                    <input type="text" id="regUsername" placeholder="Pilih username unik" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="regEmail">Email *</label>
                    <input type="email" id="regEmail" placeholder="contoh@email.com" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="regPhone">No. Telepon</label>
                    <input type="tel" id="regPhone" placeholder="+62 812-xxxx-xxxx" autocomplete="tel">
                </div>
                <div class="form-group">
                    <label for="regPassword">Password * (min. 6 karakter)</label>
                    <input type="password" id="regPassword" placeholder="Buat password kuat" required minlength="6" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="regConfirmPassword">Konfirmasi Password *</label>
                    <input type="password" id="regConfirmPassword" placeholder="Ulangi password" required minlength="6" autocomplete="new-password">
                </div>
                <button type="submit" id="registerBtn">Daftar Sekarang</button>
            </form>
            <div class="switch-form">
                Sudah punya akun? <a id="linkToLogin">Login disini</a>
            </div>
            
            <div class="form-footer">
                ¬© 2024 Sistem Login - OOP Architecture. All rights reserved.
            </div>
        </div>

        <!-- Dashboard setelah login -->
        <div id="dashboard" class="dashboard hidden">
            <h2>‚ú® Selamat Datang!</h2>
            <p class="welcome-message">Anda berhasil login ke sistem.</p>
            
            <div class="user-info">
                <p>
                    <strong>üë§ Username:</strong>
                    <span id="dashUsername"></span>
                </p>
                <p>
                    <strong>üìß Email:</strong>
                    <span id="dashEmail"></span>
                </p>
                <p>
                    <strong>üé≠ Role:</strong>
                    <span id="dashRole"></span>
                </p>
                <p>
                    <strong>üìä Status:</strong>
                    <span id="dashStatus"></span>
                </p>
                <p>
                    <strong>üìÖ Bergabung:</strong>
                    <span id="dashJoinDate"></span>
                </p>
                <p>
                    <strong>üì± No. Telepon:</strong>
                    <span id="dashPhone"></span>
                </p>
            </div>
            
            <button class="logout-btn" id="logoutBtn">Logout</button>
        </div>
    </div>

    <script>
        // ============================================
        // CLASS: User (Model)
        // Representasi object User dengan enkapsulasi data
        // ============================================
        class User {
            #password; // Private field untuk keamanan

            constructor(username, email, password, role = 'Member', phone = '', joinDate = null, status = 'active') {
                this.username = username;
                this.email = email;
                this.#password = password;
                this.role = role;
                this.phone = phone;
                this.joinDate = joinDate || this.getCurrentDate();
                this.status = status;
            }

            // Getter untuk password (enkapsulasi)
            getPassword() {
                return this.#password;
            }

            // Setter untuk password dengan validasi
            setPassword(newPassword) {
                if (newPassword.length < 6) {
                    throw new Error('Password minimal 6 karakter');
                }
                this.#password = newPassword;
            }

            // Method untuk validasi password
            validatePassword(inputPassword) {
                return this.#password === inputPassword;
            }

            // Method untuk get current date
            getCurrentDate() {
                return new Date().toISOString().split('T')[0];
            }

            // Method untuk convert ke plain object (untuk storage)
            toJSON() {
                return {
                    username: this.username,
                    email: this.email,
                    password: this.#password,
                    role: this.role,
                    phone: this.phone,
                    joinDate: this.joinDate,
                    status: this.status
                };
            }

            // Static method untuk create User dari object
            static fromJSON(data) {
                return new User(
                    data.username,
                    data.email,
                    data.password,
                    data.role,
                    data.phone,
                    data.joinDate,
                    data.status
                );
            }
        }

        // ============================================
        // CLASS: Validator (Utility)
        // Handle semua validasi input
        // ============================================
        class Validator {
            static validateUsername(username) {
                if (!username || username.trim().length < 3) {
                    throw new Error('Username minimal 3 karakter');
                }
                return true;
            }

            static validateEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    throw new Error('Format email tidak valid');
                }
                return true;
            }

            static validatePassword(password) {
                if (password.length < 6) {
                    throw new Error('Password minimal 6 karakter');
                }
                return true;
            }

            static validatePasswordMatch(password, confirmPassword) {
                if (password !== confirmPassword) {
                    throw new Error('Password dan konfirmasi password tidak cocok');
                }
                return true;
            }
        }

        // ============================================
        // CLASS: StorageManager (Data Access Layer)
        // Handle semua operasi localStorage
        // ============================================
        class StorageManager {
            constructor() {
                this.USERS_KEY = 'users';
                this.CURRENT_USER_KEY = 'currentUser';
            }

            // Get all users
            getAllUsers() {
                const data = localStorage.getItem(this.USERS_KEY);
                if (!data) return {};
                
                const usersData = JSON.parse(data);
                const users = {};
                
                // Convert plain objects to User instances
                for (const [username, userData] of Object.entries(usersData)) {
                    users[username] = User.fromJSON(userData);
                }
                
                return users;
            }

            // Save all users
            saveAllUsers(users) {
                const usersData = {};
                for (const [username, user] of Object.entries(users)) {
                    usersData[username] = user.toJSON();
                }
                localStorage.setItem(this.USERS_KEY, JSON.stringify(usersData));
            }

            // Get single user
            getUser(username) {
                const users = this.getAllUsers();
                return users[username] || null;
            }

            // Save single user
            saveUser(user) {
                const users = this.getAllUsers();
                users[user.username] = user;
                this.saveAllUsers(users);
            }

            // Check if username exists
            userExists(username) {
                return this.getUser(username) !== null;
            }

            // Check if email exists
            emailExists(email) {
                const users = this.getAllUsers();
                return Object.values(users).some(user => user.email === email);
            }

            // Get current logged in user
            getCurrentUser() {
                const data = localStorage.getItem(this.CURRENT_USER_KEY);
                return data ? User.fromJSON(JSON.parse(data)) : null;
            }

            // Set current logged in user
            setCurrentUser(user) {
                localStorage.setItem(this.CURRENT_USER_KEY, JSON.stringify(user.toJSON()));
            }

            // Remove current user (logout)
            removeCurrentUser() {
                localStorage.removeItem(this.CURRENT_USER_KEY);
            }

            // Initialize with default users
            initializeDefaultUsers() {
                if (Object.keys(this.getAllUsers()).length === 0) {
                    const defaultUsers = {
                        admin: new User('admin', 'admin@example.com', 'admin123', 'Administrator', '+62 812-3456-7890', '2024-01-01'),
                        user1: new User('user1', 'user1@example.com', 'password1', 'Member', '+62 813-1111-2222', '2024-06-15'),
                        user2: new User('user2', 'user2@example.com', 'password2', 'Member', '+62 814-3333-4444', '2024-11-20')
                    };
                    this.saveAllUsers(defaultUsers);
                }
            }
        }

        // ============================================
        // CLASS: UIManager (View Controller)
        // Handle semua operasi UI dan DOM manipulation
        // ============================================
        class UIManager {
            constructor() {
                this.loginForm = document.getElementById('loginForm');
                this.registerForm = document.getElementById('registerForm');
                this.dashboard = document.getElementById('dashboard');
            }

            showLogin() {
                this.loginForm.classList.remove('hidden');
                this.registerForm.classList.add('hidden');
                this.dashboard.classList.add('hidden');
                this.clearAllAlerts();
                this.resetAllForms();
            }

            showRegister() {
                this.registerForm.classList.remove('hidden');
                this.loginForm.classList.add('hidden');
                this.dashboard.classList.add('hidden');
                this.clearAllAlerts();
                this.resetAllForms();
            }

            showDashboard(user) {
                this.dashboard.classList.remove('hidden');
                this.loginForm.classList.add('hidden');
                this.registerForm.classList.add('hidden');
                this.renderUserInfo(user);
            }

            renderUserInfo(user) {
                document.getElementById('dashUsername').textContent = user.username;
                document.getElementById('dashEmail').textContent = user.email;
                
                const roleElement = document.getElementById('dashRole');
                const roleBadgeClass = user.role === 'Administrator' ? 'badge-admin' : 'badge-member';
                roleElement.innerHTML = `<span class="badge ${roleBadgeClass}">${user.role}</span>`;
                
                const statusElement = document.getElementById('dashStatus');
                statusElement.innerHTML = `<span class="badge badge-active">${user.status}</span>`;
                
                document.getElementById('dashJoinDate').textContent = this.formatDate(user.joinDate);
                document.getElementById('dashPhone').textContent = user.phone || 'Belum diisi';
            }

            showAlert(elementId, message, type) {
                const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
                document.getElementById(elementId).innerHTML = 
                    `<div class="alert ${alertClass}">${message}</div>`;
            }

            clearAlert(elementId) {
                document.getElementById(elementId).innerHTML = '';
            }

            clearAllAlerts() {
                this.clearAlert('loginAlert');
                this.clearAlert('registerAlert');
            }

            resetAllForms() {
                document.querySelectorAll('form').forEach(form => form.reset());
            }

            setButtonLoading(buttonId, isLoading, originalText) {
                const button = document.getElementById(buttonId);
                if (isLoading) {
                    button.disabled = true;
                    button.innerHTML = originalText + '<span class="loading"></span>';
                } else {
                    button.disabled = false;
                    button.innerHTML = originalText;
                }
            }

            formatDate(dateString) {
                if (!dateString) return '-';
                const date = new Date(dateString);
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString('id-ID', options);
            }
        }

        // ============================================
        // CLASS: AuthenticationService (Business Logic)
        // Handle authentication logic
        // ============================================
        class AuthenticationService {
            constructor(storageManager) {
                this.storage = storageManager;
            }

            // Login method
            login(username, password) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const user = this.storage.getUser(username);
                        
                        if (!user) {
                            reject(new Error('Username tidak ditemukan'));
                            return;
                        }

                        if (!user.validatePassword(password)) {
                            reject(new Error('Password salah'));
                            return;
                        }

                        this.storage.setCurrentUser(user);
                        resolve(user);
                    }, 1000);
                });
            }

            // Register method
            register(userData) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        try {
                            // Validasi input
                            Validator.validateUsername(userData.username);
                            Validator.validateEmail(userData.email);
                            Validator.validatePassword(userData.password);
                            Validator.validatePasswordMatch(userData.password, userData.confirmPassword);

                            // Check username exists
                            if (this.storage.userExists(userData.username)) {
                                reject(new Error('Username sudah terdaftar'));
                                return;
                            }

                            // Check email exists
                            if (this.storage.emailExists(userData.email)) {
                                reject(new Error('Email sudah terdaftar'));
                                return;
                            }

                            // Create new user
                            const newUser = new User(
                                userData.username,
                                userData.email,
                                userData.password,
                                'Member',
                                userData.phone || ''
                            );

                            // Save user
                            this.storage.saveUser(newUser);
                            resolve(newUser);
                        } catch (error) {
                            reject(error);
                        }
                    }, 1000);
                });
            }

            // Logout method
            logout() {
                this.storage.removeCurrentUser();
            }

            // Get current user
            getCurrentUser() {
                return this.storage.getCurrentUser();
            }
        }

        // ============================================
        // CLASS: Application (Main Controller)
        // Orchestrate semua komponen
        // ============================================
        class Application {
            constructor() {
                this.storage = new StorageManager();
                this.ui = new UIManager();
                this.auth = new AuthenticationService(this.storage);
                
                this.init();
            }

            init() {
                // Initialize default users
                this.storage.initializeDefaultUsers();

                // Setup event listeners
                this.setupEventListeners();

                // Check if user is logged in
                const currentUser = this.auth.getCurrentUser();
                if (currentUser) {
                    this.ui.showDashboard(currentUser);
                } else {
                    this.ui.showLogin();
                }

                console.log('üöÄ Sistem Login & Registrasi (OOP) telah dimuat');
                console.log('üìä Total users:', Object.keys(this.storage.getAllUsers()).length);
                console.log('üë§ Current user:', currentUser ? currentUser.username : 'Belum login');
            }

            setupEventListeners() {
                // Login form
                document.getElementById('loginFormElement').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });

                // Register form
                document.getElementById('registerFormElement').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleRegister();
                });

                // Navigation links
                document.getElementById('linkToRegister').addEventListener('click', () => {
                    this.ui.showRegister();
                });

                document.getElementById('linkToLogin').addEventListener('click', () => {
                    this.ui.showLogin();
                });

                // Logout button
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    this.handleLogout();
                });
            }

            async handleLogin() {
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value;

                this.ui.setButtonLoading('loginBtn', true, 'Login');

                try {
                    const user = await this.auth.login(username, password);
                    this.ui.showAlert('loginAlert', `‚úÖ Hi ${username}! Login berhasil, mengalihkan ke dashboard...`, 'success');
                    
                    setTimeout(() => {
                        this.ui.showDashboard(user);
                        this.ui.setButtonLoading('loginBtn', false, 'Login');
                    }, 1500);
                } catch (error) {
                    this.ui.setButtonLoading('loginBtn', false, 'Login');
                    this.ui.showAlert('loginAlert', `‚ùå Gagal login! ${error.message}`, 'error');
                }
            }

            async handleRegister() {
                const userData = {
                    username: document.getElementById('regUsername').value.trim(),
                    email: document.getElementById('regEmail').value.trim(),
                    phone: document.getElementById('regPhone').value.trim(),
                    password: document.getElementById('regPassword').value,
                    confirmPassword: document.getElementById('regConfirmPassword').value
                };

                this.ui.setButtonLoading('registerBtn', true, 'Daftar Sekarang');

                try {
                    await this.auth.register(userData);
                    this.ui.setButtonLoading('registerBtn', false, 'Daftar Sekarang');
                    this.ui.showAlert('registerAlert', 'üéâ Registrasi berhasil! Silakan login dengan akun Anda.', 'success');
                    
                    setTimeout(() => {
                        this.ui.showLogin();
                        this.ui.showAlert('loginAlert', 'Akun berhasil dibuat! Silakan login.', 'success');
                    }, 2000);
                } catch (error) {
                    this.ui.setButtonLoading('registerBtn', false, 'Daftar Sekarang');
                    this.ui.showAlert('registerAlert', `‚ùå ${error.message}`, 'error');
                }
            }

            handleLogout() {
                if (confirm('Apakah Anda yakin ingin logout?')) {
                    this.auth.logout();
                    this.ui.showLogin();
                    this.ui.showAlert('loginAlert', 'Anda telah berhasil logout. Sampai jumpa!', 'success');
                }
            }
        }

        // ============================================
        // INITIALIZATION
        // Start aplikasi
        // ============================================
        const app = new Application();
    </script>
</body>
</html>
